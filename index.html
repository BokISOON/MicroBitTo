<!DOCTYPE html>
<html>
<head>
    <title>Micro:bit USB 시리얼 온도 읽기</title>
</head>
<body>
    <button id="connectBtn">마이크로비트 연결</button>
    <pre id="output">온도 데이터 대기 중...</pre>

    <script>
        const connectBtn = document.getElementById('connectBtn');
        const output = document.getElementById('output');
        let port;
        let reader;

        connectBtn.addEventListener('click', async () => {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                output.textContent = "연결됨. 데이터 수신 대기 중...\n";

                const textDecoder = new TextDecoderStream();
                const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
                reader = textDecoder.readable.getReader();

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) {
                        break;
                    }
                    output.textContent += value;
                }
            } catch (error) {
                output.textContent = "오류: " + error;
            }
        });
    </script>
</body>
</html>
